import React, { Component } from 'react';
import { connect } from 'react-redux';
import PropTypes from 'prop-types'
import { Card, Spin } from 'antd';
import shaanxiJson from '../../../assets/data/shaanxi.json'
import ReactEcharts from 'echarts-for-react';
import echarts from 'echarts'; 

class HeatmapTodayPrem extends Component {

    
  //  构建函数
  constructor(props) {
    super(props)
    echarts.registerMap('shaanxi', shaanxiJson);
  }

  componentDidMount() {
    // 取控件数据
    this.props.dispatch({
      type: 'widgets/getData',
      payload: {
        widgetId: 'HeatmapTodayPrem'
      }
    });
  }

  getOption() {
    var geoCoordMap = {
        "610002":[108.55,34.15],
        "610151":[108.56,34,14],
        "610152":[108.59,34.16],
        "610153":[108.56,34.17],
        "610154":[108.57,34.16],
        "610155":[108.57,34.14],
        "610156":[108.57,34.14],
        "610157":[108.53,34.15],
        "610159":[108.37,34.06],
        "610160":[109.11,34.22],
        "610161":[108.12,34.09],
        "610162":[109.04,34.31],
        "610163":[108.56,34.09],
        "610164":[109.12,34.39],
        "610165":[109.18,34.09],
        "610171":[108.56,34.13],
        "610172":[108.58,34.15],
        "610173":[108.56,34.16],
        "610174":[108.55,34.15],
        "610175":[108.56,34.15],
        "610176":[108.56,34.20],
        "610178":[108.49,34.17],
        "610180":[108.55,34.14],
        "610181":[108.56,34.12],
        "610182":[108.55,34.14],
        "610201":[109.04,35.04],
        "610202":[109.05,35.06],
        "610203":[109.04,35.04],
        "610221":[108.58,34.54],
        "610222":[109.06,35.23],
        "610301":[107.08,34.22],
        "610302":[107.07,34.22],
        "610303":[107.11,34.22],
        "610304":[107.08,34.21],
        "610306":[107.08,34.22],
        "610309":[107.08,34.21],
        "610311":[107.08,34.21],
        "610321":[107.22,34.21],
        "610322":[107.23,34.30],
        "610323":[107.37,34.26],
        "610324":[107.52,34.21],
        "610326":[107.44,34.16],
        "610327":[106.51,34.53],
        "610328":[107.06,34.38],
        "610329":[107.47,34.40],
        "610330":[106.31,33.55],
        "610331":[107.18,34.03],
        "610401":[108.41,34.19],
        "610402":[108.04,34.16],
        "610403":[108.44,34.21],
        "610405":[108.41,34.19],
        "610406":[108.43,34.20],
        "610408":[108.28,34.17],
        "610418":[108.41,34.19],
        "610419":[108.43,34.19],
        "610421":[108.56,34.36],
        "610422":[108.49,34.32],
        "610423":[108.14,34.31],
        "610424":[108.26,34.28],
        "610425":[108.08,34.41],
        "610426":[108.05,35.02],
        "610427":[107.47,35.12],
        "610428":[108.20,35.06],
        "610429":[108.35,34.47],
        "610430":[108.12,34.15],
        "610436":[108.40,34.19],
        "610501":[109.29,34.29],
        "610502":[109.29,34.29],
        "610503":[109.28,34.29],
        "610504":[109.29,34.29],
        "610505":[110.26,35.28],
        "610506":[110.05,34.33],
        "610508":[109.29,34.30],
        "610523":[109.46,34.29],
        "610524":[110.14,34.32],
        "610525":[109.56,34.47],
        "610526":[109.36,34.57],
        "610527":[109.56,35.11],
        "610528":[109.35,35.10],
        "610529":[110.09,35.14],
        "610530":[109.11,34.44],
        "610601":[107.01,33.04],
        "610602":[107.01,33.04],
        "610603":[107.01,33.04],
        "610605":[107.01,33.04],
        "610606":[107.01,33.04],
        "610607":[107.01,33.04],
        "610608":[107.01,33.04],
        "610621":[106.56,33.00],
        "610622":[107.19,33.08],
        "610623":[107.32,33.13],
        "610624":[107.45,32.59],
        "610625":[106.40,33.09],
        "610626":[106.14,32.50],
        "610627":[106.08,33.20],
        "610628":[107.53,32.32],
        "610629":[106.55,33.36],
        "610702":[109.31,36.37],
        "610703":[109.31,36.37],
        "610704":[109.31,36.37],
        "610721":[110.00,36.34],
        "610722":[110.11,36.52],
        "610723":[109.40,37.08],
        "610724":[109.19,36.51],
        "610725":[108.46,36.48],
        "610726":[108.10,36.55],
        "610727":[109.20,36.16],
        "610728":[109.22,35.59],
        "610729":[109.25,35.45],
        "610730":[110.09,36.03],
        "610731":[109.49,35.35],
        "610732":[109.15,35.34],
        "612101":[109.01,32.41],
        "612103":[109.01,32.41],
        "612104":[109.00,32.42],
        "612107":[109.01,32.41],
        "612110":[108.53,32.43],
        "612111":[108.46,32.44],
        "612118":[109.00,32.41],
        "612121":[108.30,32.53],
        "612122":[108.14,33.02],
        "612123":[108.18,33.18],
        "612124":[108.32,32.31],
        "612125":[108.53,32.18],
        "612126":[109.21,32.23],
        "612127":[109.31,31.53],
        "612128":[109.21,32.50],
        "612129":[110.06,32.48],
        "612201":[109.55,33.52],
        "612202":[109.56,33.52],
        "612203":[109.56,33.51],
        "612204":[109.54,33.52],
        "612205":[109.55,33.52],
        "612221":[110.08,34.05],
        "612222":[110.19,33.41],
        "612223":[110.52,33.31],
        "612224":[109.52,33.31],
        "612225":[109.08,33.25],
        "612226":[109.06,33.40],
        "612303":[109.45,38.16],
        "612321":[110.30,38.48],
        "612322":[111.03,39.01],
        "612323":[109.17,37.58],
        "612324":[108.47,37.35],
        "612325":[107.35,37.35],
        "612326":[110.15,37.29],
        "612327":[110.09,37.45],
        "612328":[110.29,38.01],
        "612329":[110.43,37.27],
        "612330":[110.06,37.05],
        "612331":[110.01,37.36],
        "612332":[110.13,39.16],
        "612336":[109.46,38.16],
        "612337":[109.44,38.18],
        "612338":[110.29,38.50],
        "612341":[110.10,38.45],
        "612342":[109.45,38.16]
    };


var convertData = function (data) {
    var res = [];
    for (var i = 0; i < data.length; i++) {
        var geoCoord = geoCoordMap[data[i].branch];
        if (geoCoord) {
            res.push(geoCoord.concat(data[i].amnt));
        }
    }
    return res;
};

let option = {
   title: {
        text: '当日保费热力',
        left: '5%',
        top: '5%',
        textStyle: {
            color: '#fff'
        }
    },
    backgroundColor: '#404a59',
    visualMap: {
      left: '5%',
      top: '12%',
        //min: 0,
        //max: 30,
        //splitNumber: 5,
        pieces: [
             {min: 0, max: 5},
             {min: 5, max: 10},
             {min: 10, max: 50},
             {min: 50, max: 100},
             {min: 100, max: 200}, 
             {min:200},// 不指定 max，表示 max 为无限大（Infinity）。
        ],
        inRange: {
            color: ['#d94e5d','#eac736','#50a3ba'].reverse()
        },
        textStyle: {
            color: '#bfbfbf'
        }
    },
    geo: {
        map: 'shaanxi',
        top: '3%',
        bottom: '3%',
        roam: true,
        label: {
            emphasis: {
               textStyle:{
                   color:'#fff'
               }
            }
        },
        itemStyle: {
            normal: {
               areaColor: '#323c48',
                borderColor: '#111'
            },
            emphasis: {
                areaColor: '#2a333d'
            }
        }
    },
    series: [{
        name: 'AQI',
        type: 'heatmap',
        coordinateSystem: 'geo',
        data: convertData(this.props.data)
    }]
};
return option;
  }

  render() {
    return (
    <Spin spinning={this.props.loading} size="large" tip="加载中...">
    {
      this.props.data &&
        <ReactEcharts
            option={this.getOption()} 
            notMerge={true}
            style={{height: '400px', width: '100%'}} 
            lazyUpdate={true}
        />
    }
    </Spin> 
    );
  }
}

HeatmapTodayPrem.propTypes = {
  location: PropTypes.object,
  dispatch: PropTypes.func,
}

export default connect(({ user, widgets }) => ({
  user,
  params: widgets.params.HeatmapTodayPrem,
  data: widgets.data.HeatmapTodayPrem,
  loading: widgets.loading.HeatmapTodayPrem,
}))(HeatmapTodayPrem)
